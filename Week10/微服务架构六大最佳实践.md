# 微服务架构六大最佳实践

## 遗留系统改造

1. 功能剥离、数据解耦
2. 自然演进、逐步拆分
3. 小步快跑、快速迭代
4. 灰度发布、谨慎试错
5. 提质量线、还技术债

## 恰当粒度拆分

拆分原则：

1. 高内聚低耦合
   1. 联系紧密的应该在同一个微服务里面
2. 不同阶段拆分要点不同
   1. 不要一上来就做一步到位的拆分
   2. 可以拆有问题有风险的地方

## 扩展立方体

1. 水平复制：复制系统
2. 功能解耦：拆分业务
   1. 2个用户，10个订单
3. 数据分区：切分数据
   1. 同样的订单拆分到不同的数据库不同的表中
   2. 单独部署好的机器为前500VIP客户服务

**单元化架构的基础**

特性开关+容错设计

特性开关：用来做A/B测试用的开关，灰度测试用的

## 自动化管理

- 自动化测试
- 自动化部署
- 自动化运维

降低服务拆分带来的复杂性，提升测试、部署、运维效率

## 分布式事务

**慎用分布式事务**，让处理的数据天然是隔离的

幂等、去重、补偿

## 完善监控体系

1. 业务监控
2. 系统监控
3. 容量规划
4. 报警预警
5. 运维流程
   1. 大规模微服务发布、部署上线一定要有一些发布流程、变更的流程标准
6. 故障处理
   1. 把所有的故障都收集起来，后面做根因分析
      1. 天灾（应急机制）、人祸（教育人就行）、大家知识能力储备不足
   2. 一次宕机，提前告诉用户和不告诉用户，是两个概念
   3. Devops（开发人员做运维发布）+SRE（运维人员做系统稳定性工作）

